import{r as e,j as t}from"./react-C_CxT2AP.js";import{L as n,T as r,R as o,U as a,a as i,O as s,P as c,S as l,b as u,N as f,A as d,B as p,M as m,C as h,V as v,c as g,W as y,d as b,e as w,f as _,g as x,h as E,i as P,D as M,j as C,k as j,l as S,m as O,E as k,n as z,o as A,p as T,q as R,r as L,s as I,t as D}from"./three-CKzNlV_8.js";import{c as F}from"./debounce-3O3shGHB.js";import{F as H,u as W}from"./its-fine-qhlOUAnL.js";import{R as $,c as U}from"./react-reconciler-ClBrrcBL.js";import{_ as q}from"./@babel-DPdBf6DS.js";import{c as B}from"./react-dom-DEr86DwX.js";import{c as N}from"./zustand-CLLX5Zmf.js";import"./maath-ChQRU3eB.js";import{D as G,G as Y,a as V,M as X,O as Z}from"./three-stdlib-B1KH3Uve.js";import{s as J,p as K,c as Q}from"./suspend-react-BjVxDtan.js";function ee(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function te(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var n=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),n}const ne={},re=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),n=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));r=Promise.allSettled(t.map((e=>{if((e=function(e){return"/"+e}(e))in ne)return;ne[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const o=document.createElement("link");return o.rel=t?"stylesheet":"modulepreload",t||(o.as="script"),o.crossOrigin="",o.href=e,n&&o.setAttribute("nonce",n),document.head.appendChild(o),t?new Promise(((t,n)=>{o.addEventListener("load",t),o.addEventListener("error",(()=>n(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function o(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then((t=>{for(const e of t||[])"rejected"===e.status&&o(e.reason);return e().catch(o)}))};var oe={exports:{}},ae={};!function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<o(a,t)))break e;e[r]=t,e[n]=a,n=r}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,i=a>>>1;r<i;){var s=2*(r+1)-1,c=e[s],l=s+1,u=e[l];if(0>o(c,n))l<a&&0>o(u,c)?(e[r]=u,e[l]=n,r=l):(e[r]=c,e[s]=n,r=s);else{if(!(l<a&&0>o(u,n)))break e;e[r]=u,e[l]=n,r=l}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var a=performance;e.unstable_now=function(){return a.now()}}else{var i=Date,s=i.now();e.unstable_now=function(){return i.now()-s}}var c=[],l=[],u=1,f=null,d=3,p=!1,m=!1,h=!1,v="function"==typeof setTimeout?setTimeout:null,g="function"==typeof clearTimeout?clearTimeout:null,y="undefined"!=typeof setImmediate?setImmediate:null;function b(e){for(var o=n(l);null!==o;){if(null===o.callback)r(l);else{if(!(o.startTime<=e))break;r(l),o.sortIndex=o.expirationTime,t(c,o)}o=n(l)}}function w(e){if(h=!1,b(e),!m)if(null!==n(c))m=!0,A(_);else{var t=n(l);null!==t&&T(w,t.startTime-e)}}function _(t,o){m=!1,h&&(h=!1,g(M),M=-1),p=!0;var a=d;try{for(b(o),f=n(c);null!==f&&(!(f.expirationTime>o)||t&&!S());){var i=f.callback;if("function"==typeof i){f.callback=null,d=f.priorityLevel;var s=i(f.expirationTime<=o);o=e.unstable_now(),"function"==typeof s?f.callback=s:f===n(c)&&r(c),b(o)}else r(c);f=n(c)}if(null!==f)var u=!0;else{var v=n(l);null!==v&&T(w,v.startTime-o),u=!1}return u}finally{f=null,d=a,p=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var x,E=!1,P=null,M=-1,C=5,j=-1;function S(){return!(e.unstable_now()-j<C)}function O(){if(null!==P){var t=e.unstable_now();j=t;var n=!0;try{n=P(!0,t)}finally{n?x():(E=!1,P=null)}}else E=!1}if("function"==typeof y)x=function(){y(O)};else if("undefined"!=typeof MessageChannel){var k=new MessageChannel,z=k.port2;k.port1.onmessage=O,x=function(){z.postMessage(null)}}else x=function(){v(O,0)};function A(e){P=e,E||(E=!0,x())}function T(t,n){M=v((function(){t(e.unstable_now())}),n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){m||p||(m=!0,A(_))},e.unstable_forceFrameRate=function(e){0>e||125<e||(C=0<e?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(e){switch(d){case 1:case 2:case 3:var t=3;break;default:t=d}var n=d;d=t;try{return e()}finally{d=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=d;d=e;try{return t()}finally{d=n}},e.unstable_scheduleCallback=function(r,o,a){var i=e.unstable_now();switch("object"==typeof a&&null!==a?a="number"==typeof(a=a.delay)&&0<a?i+a:i:a=i,r){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return r={id:u++,callback:o,priorityLevel:r,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>i?(r.sortIndex=a,t(l,r),null===n(c)&&r===n(l)&&(h?(g(M),M=-1):h=!0,T(w,a-i))):(r.sortIndex=s,t(c,r),m||p||(m=!0,A(_))),r},e.unstable_shouldYield=S,e.unstable_wrapCallback=function(e){var t=d;return function(){var n=d;d=t;try{return e.apply(this,arguments)}finally{d=n}}}}(ae),oe.exports=ae;var ie=oe.exports;const se={};var ce,le;const ue=e=>"colorSpace"in e||"outputColorSpace"in e,fe=()=>{var e;return null!=(e=se.ColorManagement)?e:null},de=e=>e&&e.isOrthographicCamera,pe="undefined"!=typeof window&&(null!=(ce=window.document)&&ce.createElement||"ReactNative"===(null==(le=window.navigator)?void 0:le.product))?e.useLayoutEffect:e.useEffect;function me(t){const n=e.useRef(t);return pe((()=>{n.current=t}),[t]),n}function he({set:e}){return pe((()=>(e(new Promise((()=>null))),()=>e(!1))),[e]),null}class ve extends e.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}ve.getDerivedStateFromError=()=>({error:!0});const ge="__default",ye=new Map,be=e=>e&&!!e.memoized&&!!e.changes;function we(e){var t;const n="undefined"!=typeof window?null!=(t=window.devicePixelRatio)?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const _e=e=>{var t;return null==(t=e.__r3f)?void 0:t.root.getState()};function xe(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const Ee={obj:e=>e===Object(e)&&!Ee.arr(e)&&"function"!=typeof e,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,boo:e=>"boolean"==typeof e,und:e=>void 0===e,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:r="reference",strict:o=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(Ee.str(e)||Ee.num(e)||Ee.boo(e))return e===t;const a=Ee.obj(e);if(a&&"reference"===r)return e===t;const i=Ee.arr(e);if(i&&"reference"===n)return e===t;if((i||a)&&e===t)return!0;let s;for(s in e)if(!(s in t))return!1;if(a&&"shallow"===n&&"shallow"===r){for(s in o?t:e)if(!Ee.equ(e[s],t[s],{strict:o,objects:"reference"}))return!1}else for(s in o?t:e)if(e[s]!==t[s])return!1;if(Ee.und(s)){if(i&&0===e.length&&0===t.length)return!0;if(a&&0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(e!==t)return!1}return!0}};function Pe(e,t){return e.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Me(e,t){let n=e;if(t.includes("-")){const r=t.split("-"),o=r.pop();return n=r.reduce(((e,t)=>e[t]),e),{target:n,key:o}}return{target:n,key:t}}const Ce=/-\d+$/;function je(e,t,n){if(Ee.str(n)){if(Ce.test(n)){const t=n.replace(Ce,""),{target:r,key:o}=Me(e,t);Array.isArray(r[o])||(r[o]=[])}const{target:r,key:o}=Me(e,n);t.__r3f.previousAttach=r[o],r[o]=t}else t.__r3f.previousAttach=n(e,t)}function Se(e,t,n){var r,o;if(Ee.str(n)){const{target:r,key:o}=Me(e,n),a=t.__r3f.previousAttach;void 0===a?delete r[o]:r[o]=a}else null==(r=t.__r3f)||null==r.previousAttach||r.previousAttach(e,t);null==(o=t.__r3f)||delete o.previousAttach}function Oe(e,{children:t,key:n,ref:r,...o},{children:a,key:i,ref:s,...c}={},l=!1){const u=e.__r3f,f=Object.entries(o),d=[];if(l){const e=Object.keys(c);for(let t=0;t<e.length;t++)o.hasOwnProperty(e[t])||f.unshift([e[t],ge+"remove"])}f.forEach((([t,n])=>{var r;if(null!=(r=e.__r3f)&&r.primitive&&"object"===t)return;if(Ee.equ(n,c[t]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(t))return d.push([t,n,!0,[]]);let a=[];t.includes("-")&&(a=t.split("-")),d.push([t,n,!1,a]);for(const e in o){const n=o[e];e.startsWith(`${t}-`)&&d.push([e,n,!1,e.split("-")])}}));const p={...o};return null!=u&&u.memoizedProps&&null!=u&&u.memoizedProps.args&&(p.args=u.memoizedProps.args),null!=u&&u.memoizedProps&&null!=u&&u.memoizedProps.attach&&(p.attach=u.memoizedProps.attach),{memoized:p,changes:d}}const ke="undefined"!=typeof process&&!1;function ze(e,t){var i;const s=e.__r3f,c=null==s?void 0:s.root,l=null==c||null==c.getState?void 0:c.getState(),{memoized:u,changes:f}=be(t)?t:Oe(e,t),d=null==s?void 0:s.eventCount;e.__r3f&&(e.__r3f.memoizedProps=u);for(let p=0;p<f.length;p++){let[t,i,c,u]=f[p];if(ue(e)){const e=3001,n="srgb",r="srgb-linear";"encoding"===t?(t="colorSpace",i=i===e?n:r):"outputEncoding"===t&&(t="outputColorSpace",i=i===e?n:r)}let d=e,m=d[t];if(u.length&&(m=u.reduce(((e,t)=>e[t]),e),!m||!m.set)){const[n,...r]=u.reverse();d=r.reverse().reduce(((e,t)=>e[t]),e),t=n}if(i===ge+"remove")if(d.constructor){let e=ye.get(d.constructor);e||(e=new d.constructor,ye.set(d.constructor,e)),i=e[t]}else i=0;if(c&&s)i?s.handlers[t]=i:delete s.handlers[t],s.eventCount=Object.keys(s.handlers).length;else if(m&&m.set&&(m.copy||m instanceof n)){if(Array.isArray(i))m.fromArray?m.fromArray(i):m.set(...i);else if(m.copy&&i&&i.constructor&&(ke?m.constructor.name===i.constructor.name:m.constructor===i.constructor))m.copy(i);else if(void 0!==i){const e=m instanceof h;!e&&m.setScalar?m.setScalar(i):m instanceof n&&i instanceof n?m.mask=i.mask:m.set(i),!fe()&&l&&!l.linear&&e&&m.convertSRGBToLinear()}}else if(d[t]=i,d[t]instanceof r&&d[t].format===o&&d[t].type===a&&l){const e=d[t];ue(e)&&ue(l.gl)?e.colorSpace=l.gl.outputColorSpace:e.encoding=l.gl.outputEncoding}Ae(e)}if(s&&s.parent&&e.raycast&&d!==s.eventCount){const t=xe(e).getState().internal,n=t.interaction.indexOf(e);n>-1&&t.interaction.splice(n,1),s.eventCount&&t.interaction.push(e)}return!(1===f.length&&"onUpdate"===f[0][0])&&f.length&&null!=(i=e.__r3f)&&i.parent&&Te(e),e}function Ae(e){var t,n;const r=null==(t=e.__r3f)||null==(n=t.root)||null==n.getState?void 0:n.getState();r&&0===r.internal.frames&&r.invalidate()}function Te(e){null==e.onUpdate||e.onUpdate(e)}function Re(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Le(e,t,n,r){const o=n.get(t);o&&(n.delete(t),0===n.size&&(e.delete(r),o.target.releasePointerCapture(r)))}function Ie(e){function t(e){return e.filter((e=>["Move","Over","Enter","Out","Leave"].some((t=>{var n;return null==(n=e.__r3f)?void 0:n.handlers["onPointer"+t]}))))}function n(t){const{internal:n}=e.getState();for(const e of n.hovered.values())if(!t.length||!t.find((t=>t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId))){const r=e.eventObject.__r3f,o=null==r?void 0:r.handlers;if(n.hovered.delete(Re(e)),null!=r&&r.eventCount){const n={...e,intersections:t};null==o.onPointerOut||o.onPointerOut(n),null==o.onPointerLeave||o.onPointerLeave(n)}}}function r(e,t){for(let n=0;n<t.length;n++){const r=t[n].__r3f;null==r||null==r.handlers.onPointerMissed||r.handlers.onPointerMissed(e)}}return{handlePointer:function(o){switch(o){case"onPointerLeave":case"onPointerCancel":return()=>n([]);case"onLostPointerCapture":return t=>{const{internal:r}=e.getState();"pointerId"in t&&r.capturedMap.has(t.pointerId)&&requestAnimationFrame((()=>{r.capturedMap.has(t.pointerId)&&(r.capturedMap.delete(t.pointerId),n([]))}))}}return function(a){const{onPointerMissed:i,internal:s}=e.getState();s.lastEvent.current=a;const c="onPointerMove"===o,l="onClick"===o||"onContextMenu"===o||"onDoubleClick"===o,u=function(t,n){const r=e.getState(),o=new Set,a=[],i=n?n(r.internal.interaction):r.internal.interaction;for(let e=0;e<i.length;e++){const t=_e(i[e]);t&&(t.raycaster.camera=void 0)}r.previousRoot||null==r.events.compute||r.events.compute(t,r);let s=i.flatMap((function(e){const n=_e(e);return n&&n.events.enabled&&null!==n.raycaster.camera?(void 0===n.raycaster.camera&&(null==n.events.compute||n.events.compute(t,n,null==(r=n.previousRoot)?void 0:r.getState()),void 0===n.raycaster.camera&&(n.raycaster.camera=null)),n.raycaster.camera?n.raycaster.intersectObject(e,!0):[]):[];var r})).sort(((e,t)=>{const n=_e(e.object),r=_e(t.object);return n&&r&&r.events.priority-n.events.priority||e.distance-t.distance})).filter((e=>{const t=Re(e);return!o.has(t)&&(o.add(t),!0)}));r.events.filter&&(s=r.events.filter(s,r));for(const e of s){let t=e.object;for(;t;){var c;null!=(c=t.__r3f)&&c.eventCount&&a.push({...e,eventObject:t}),t=t.parent}}if("pointerId"in t&&r.internal.capturedMap.has(t.pointerId))for(let e of r.internal.capturedMap.get(t.pointerId).values())o.has(Re(e.intersection))||a.push(e.intersection);return a}(a,c?t:void 0),f=l?function(t){const{internal:n}=e.getState(),r=t.offsetX-n.initialClick[0],o=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(r*r+o*o))}(a):0;"onPointerDown"===o&&(s.initialClick=[a.offsetX,a.offsetY],s.initialHits=u.map((e=>e.eventObject))),l&&!u.length&&f<=2&&(r(a,s.interaction),i&&i(a)),c&&n(u),function(t,r,o,a){const i=e.getState();if(t.length){const e={stopped:!1};for(const s of t){const c=_e(s.object)||i,{raycaster:l,pointer:u,camera:f,internal:d}=c,p=new v(u.x,u.y,0).unproject(f),m=e=>{var t,n;return null!=(t=null==(n=d.capturedMap.get(e))?void 0:n.has(s.eventObject))&&t},h=e=>{const t={intersection:s,target:r.target};d.capturedMap.has(e)?d.capturedMap.get(e).set(s.eventObject,t):d.capturedMap.set(e,new Map([[s.eventObject,t]])),r.target.setPointerCapture(e)},g=e=>{const t=d.capturedMap.get(e);t&&Le(d.capturedMap,s.eventObject,t,e)};let y={};for(let e in r){let t=r[e];"function"!=typeof t&&(y[e]=t)}let b={...s,...y,pointer:u,intersections:t,stopped:e.stopped,delta:o,unprojectedPoint:p,ray:l.ray,camera:f,stopPropagation(){const o="pointerId"in r&&d.capturedMap.get(r.pointerId);(!o||o.has(s.eventObject))&&(b.stopped=e.stopped=!0,d.hovered.size&&Array.from(d.hovered.values()).find((e=>e.eventObject===s.eventObject)))&&n([...t.slice(0,t.indexOf(s)),s])},target:{hasPointerCapture:m,setPointerCapture:h,releasePointerCapture:g},currentTarget:{hasPointerCapture:m,setPointerCapture:h,releasePointerCapture:g},nativeEvent:r};if(a(b),!0===e.stopped)break}}}(u,a,f,(function(e){const t=e.eventObject,n=t.__r3f,i=null==n?void 0:n.handlers;if(null!=n&&n.eventCount)if(c){if(i.onPointerOver||i.onPointerEnter||i.onPointerOut||i.onPointerLeave){const t=Re(e),n=s.hovered.get(t);n?n.stopped&&e.stopPropagation():(s.hovered.set(t,e),null==i.onPointerOver||i.onPointerOver(e),null==i.onPointerEnter||i.onPointerEnter(e))}null==i.onPointerMove||i.onPointerMove(e)}else{const n=i[o];n?l&&!s.initialHits.includes(t)||(r(a,s.interaction.filter((e=>!s.initialHits.includes(e)))),n(e)):l&&s.initialHits.includes(t)&&r(a,s.interaction.filter((e=>!s.initialHits.includes(e))))}}))}}}}const De=e=>!(null==e||!e.render),Fe=e.createContext(null),He=(t,n)=>{const r=N(((r,o)=>{const a=new v,i=new v,s=new v;function c(e=o().camera,t=i,n=o().size){const{width:r,height:c,top:l,left:u}=n,f=r/c;t instanceof v?s.copy(t):s.set(...t);const d=e.getWorldPosition(a).distanceTo(s);if(de(e))return{width:r/e.zoom,height:c/e.zoom,top:l,left:u,factor:1,distance:d,aspect:f};{const t=e.fov*Math.PI/180,n=2*Math.tan(t/2)*d,o=n*(r/c);return{width:o,height:n,top:l,left:u,factor:r/o,distance:d,aspect:f}}}let l;const u=e=>r((t=>({performance:{...t.performance,current:e}}))),f=new g;return{set:r,get:o,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(e=1)=>t(o(),e),advance:(e,t)=>n(e,t,o()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new E,pointer:f,mouse:f,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const e=o();l&&clearTimeout(l),e.performance.current!==e.performance.min&&u(e.performance.min),l=setTimeout((()=>u(o().performance.max)),e.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:c},setEvents:e=>r((t=>({...t,events:{...t.events,...e}}))),setSize:(e,t,n,a,s)=>{const l=o().camera,u={width:e,height:t,top:a||0,left:s||0,updateStyle:n};r((e=>({size:u,viewport:{...e.viewport,...c(l,i,u)}})))},setDpr:e=>r((t=>{const n=we(e);return{viewport:{...t.viewport,dpr:n,initialDpr:t.viewport.initialDpr||n}}})),setFrameloop:(e="always")=>{const t=o().clock;t.stop(),t.elapsedTime=0,"never"!==e&&(t.start(),t.elapsedTime=0),r((()=>({frameloop:e})))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:e.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(e,t,n)=>{const r=o().internal;return r.priority=r.priority+(t>0?1:0),r.subscribers.push({ref:e,priority:t,store:n}),r.subscribers=r.subscribers.sort(((e,t)=>e.priority-t.priority)),()=>{const n=o().internal;null!=n&&n.subscribers&&(n.priority=n.priority-(t>0?1:0),n.subscribers=n.subscribers.filter((t=>t.ref!==e)))}}}}})),o=r.getState();let a=o.size,i=o.viewport.dpr,s=o.camera;return r.subscribe((()=>{const{camera:e,size:t,viewport:n,gl:o,set:c}=r.getState();if(t.width!==a.width||t.height!==a.height||n.dpr!==i){var l;a=t,i=n.dpr,function(e,t){e.manual||(de(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}(e,t),o.setPixelRatio(n.dpr);const r=null!=(l=t.updateStyle)?l:"undefined"!=typeof HTMLCanvasElement&&o.domElement instanceof HTMLCanvasElement;o.setSize(t.width,t.height,r)}e!==s&&(s=e,c((t=>({viewport:{...t.viewport,...t.viewport.getCurrentViewport(e)}}))))})),r.subscribe((e=>t(e))),r};let We,$e,Ue,qe=new Set,Be=new Set,Ne=new Set;function Ge(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function Ye(e,t){switch(e){case"before":return Ge(qe,t);case"after":return Ge(Be,t);case"tail":return Ge(Ne,t)}}function Ve(e,t,n){let r=t.clock.getDelta();for("never"===t.frameloop&&"number"==typeof e&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),$e=t.internal.subscribers,We=0;We<$e.length;We++)Ue=$e[We],Ue.ref.current(Ue.store.getState(),r,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}function Xe(){const t=e.useContext(Fe);if(!t)throw new Error("R3F: Hooks can only be used within the Canvas component!");return t}function Ze(e=e=>e,t){return Xe()(e,t)}function Je(e,t=0){const n=Xe(),r=n.getState().internal.subscribe,o=me(e);return pe((()=>r(o,t,n)),[t,r,n]),null}const Ke=new WeakMap;function Qe(e,t){return function(n,...r){let o=Ke.get(n);return o||(o=new n,Ke.set(n,o)),e&&e(o),Promise.all(r.map((e=>new Promise(((n,r)=>o.load(e,(e=>{e.scene&&Object.assign(e,function(e){const t={nodes:{},materials:{}};return e&&e.traverse((e=>{e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)})),t}(e.scene)),n(e)}),t,(t=>r(new Error(`Could not load ${e}: ${null==t?void 0:t.message}`)))))))))}}function et(e,t,n,r){const o=Array.isArray(t)?t:[t],a=J(Qe(n,r),[e,...o],{equal:Ee.equ});return Array.isArray(t)?a:a[0]}et.preload=function(e,t,n){const r=Array.isArray(t)?t:[t];return K(Qe(n),[e,...r])},et.clear=function(e,t){const n=Array.isArray(t)?t:[t];return Q([e,...n])};const tt=new Map,{invalidate:nt,advance:rt}=function(e){let t,n,r,o=!1,a=!1;function i(s){n=requestAnimationFrame(i),o=!0,t=0,Ye("before",s),a=!0;for(const n of e.values()){var c;r=n.store.getState(),!r.internal.active||!("always"===r.frameloop||r.internal.frames>0)||null!=(c=r.gl.xr)&&c.isPresenting||(t+=Ve(s,r))}if(a=!1,Ye("after",s),0===t)return Ye("tail",s),o=!1,cancelAnimationFrame(n)}return{loop:i,invalidate:function t(n,r=1){var s;if(!n)return e.forEach((e=>t(e.store.getState(),r)));null!=(s=n.gl.xr)&&s.isPresenting||!n.internal.active||"never"===n.frameloop||(n.internal.frames=r>1?Math.min(60,n.internal.frames+r):a?2:1,o||(o=!0,requestAnimationFrame(i)))},advance:function(t,n=!0,r,o){if(n&&Ye("before",t),r)Ve(t,r,o);else for(const a of e.values())Ve(t,a.store.getState());n&&Ye("after",t)}}}(tt),{reconciler:ot,applyProps:at}=function(e,t){function n(e,{args:t=[],attach:n,...r},o){let a,i=`${e[0].toUpperCase()}${e.slice(1)}`;if("primitive"===e){if(void 0===r.object)throw new Error("R3F: Primitives without 'object' are invalid!");a=Pe(r.object,{type:e,root:o,attach:n,primitive:!0})}else{const r=se[i];if(!r)throw new Error(`R3F: ${i} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(t))throw new Error("R3F: The args prop must be an array!");a=Pe(new r(...t),{type:e,root:o,attach:n,memoizedProps:{args:t}})}return void 0===a.__r3f.attach&&(a instanceof p?a.__r3f.attach="geometry":a instanceof m&&(a.__r3f.attach="material")),"inject"!==i&&ze(a,r),a}function r(e,t){let n=!1;var r,o;t&&(null!=(r=t.__r3f)&&r.attach?je(e,t,t.__r3f.attach):t.isObject3D&&e.isObject3D&&(e.add(t),n=!0),n||null==(o=e.__r3f)||o.objects.push(t),t.__r3f||Pe(t,{}),t.__r3f.parent=e,Te(t),Ae(t))}function o(e,t,n){let r=!1;if(t){var o,a;if(null!=(o=t.__r3f)&&o.attach)je(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){t.parent=e,t.dispatchEvent({type:"added"}),e.dispatchEvent({type:"childadded",child:t});const o=e.children.filter((e=>e!==t)),a=o.indexOf(n);e.children=[...o.slice(0,a),t,...o.slice(a)],r=!0}r||null==(a=e.__r3f)||a.objects.push(t),t.__r3f||Pe(t,{}),t.__r3f.parent=e,Te(t),Ae(t)}}function a(e,t,n=!1){e&&[...e].forEach((e=>i(t,e,n)))}function i(e,t,n){if(t){var r,o,i;if(t.__r3f&&(t.__r3f.parent=null),null!=(r=e.__r3f)&&r.objects&&(e.__r3f.objects=e.__r3f.objects.filter((e=>e!==t))),null!=(o=t.__r3f)&&o.attach)Se(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){var s;e.remove(t),null!=(s=t.__r3f)&&s.root&&function(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter((e=>e!==t)),n.initialHits=n.initialHits.filter((e=>e!==t)),n.hovered.forEach(((e,r)=>{e.eventObject!==t&&e.object!==t||n.hovered.delete(r)})),n.capturedMap.forEach(((e,r)=>{Le(n.capturedMap,t,e,r)}))}(xe(t),t)}const l=null==(i=t.__r3f)?void 0:i.primitive,u=!l&&(void 0===n?null!==t.dispose:n);var c;if(!l)a(null==(c=t.__r3f)?void 0:c.objects,t,u),a(t.children,t,u);if(delete t.__r3f,u&&t.dispose&&"Scene"!==t.type){const e=()=>{try{t.dispose()}catch(e){}};"undefined"==typeof IS_REACT_ACT_ENVIRONMENT?ie.unstable_scheduleCallback(ie.unstable_IdlePriority,e):e()}Ae(e)}}const s=()=>{};return{reconciler:$({createInstance:n,removeChild:i,appendChild:r,appendInitialChild:r,insertBefore:o,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(e,t)=>{if(!t)return;const n=e.getState().scene;n.__r3f&&(n.__r3f.root=e,r(n,t))},removeChildFromContainer:(e,t)=>{t&&i(e.getState().scene,t)},insertInContainerBefore:(e,t,n)=>{if(!t||!n)return;const r=e.getState().scene;r.__r3f&&o(r,t,n)},getRootHostContext:()=>null,getChildHostContext:e=>e,finalizeInitialChildren(e){var t;const n=null!=(t=null==e?void 0:e.__r3f)?t:{};return Boolean(n.handlers)},prepareUpdate(e,t,n,r){var o;if((null!=(o=null==e?void 0:e.__r3f)?o:{}).primitive&&r.object&&r.object!==e)return[!0];{const{args:t=[],children:o,...a}=r,{args:i=[],children:s,...c}=n;if(!Array.isArray(t))throw new Error("R3F: the args prop must be an array!");if(t.some(((e,t)=>e!==i[t])))return[!0];const l=Oe(e,a,c,!0);return l.changes.length?[!1,l]:null}},commitUpdate(e,[t,o],a,s,c,l){t?function(e,t,o,a){var s;const c=null==(s=e.__r3f)?void 0:s.parent;if(!c)return;const l=n(t,o,e.__r3f.root);if(e.children){for(const t of e.children)t.__r3f&&r(l,t);e.children=e.children.filter((e=>!e.__r3f))}e.__r3f.objects.forEach((e=>r(l,e))),e.__r3f.objects=[],e.__r3f.autoRemovedBeforeAppend||i(c,e),l.parent&&(l.__r3f.autoRemovedBeforeAppend=!0),r(c,l),l.raycast&&l.__r3f.eventCount&&xe(l).getState().internal.interaction.push(l);[a,a.alternate].forEach((e=>{null!==e&&(e.stateNode=l,e.ref&&("function"==typeof e.ref?e.ref(l):e.ref.current=l))}))}(e,a,c,l):ze(e,o)},commitMount(e,t,n,r){var o;const a=null!=(o=e.__r3f)?o:{};e.raycast&&a.handlers&&a.eventCount&&xe(e).getState().internal.interaction.push(e)},getPublicInstance:e=>e,prepareForCommit:()=>null,preparePortalMount:e=>Pe(e.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(e){var t;const{attach:n,parent:r}=null!=(t=e.__r3f)?t:{};n&&r&&Se(r,e,n),e.isObject3D&&(e.visible=!1),Ae(e)},unhideInstance(e,t){var n;const{attach:r,parent:o}=null!=(n=e.__r3f)?n:{};r&&o&&je(o,e,r),(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0),Ae(e)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>t?t():U.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:"undefined"!=typeof performance&&Ee.fun(performance.now)?performance.now:Ee.fun(Date.now)?Date.now:()=>0,scheduleTimeout:Ee.fun(setTimeout)?setTimeout:void 0,cancelTimeout:Ee.fun(clearTimeout)?clearTimeout:void 0}),applyProps:ze}}(0,(function(){var e;const t="undefined"!=typeof self&&self||"undefined"!=typeof window&&window;if(!t)return U.DefaultEventPriority;switch(null==(e=t.event)?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return U.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return U.ContinuousEventPriority;default:return U.DefaultEventPriority}})),it={objects:"shallow",strict:!1},st=(e,t)=>{const n="function"==typeof e?e(t):e;return De(n)?n:new y({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function ct(e){const n=tt.get(e),r=null==n?void 0:n.fiber,o=null==n?void 0:n.store,a="function"==typeof reportError?reportError:console.error,p=o||He(nt,rt),m=r||ot.createContainer(p,U.ConcurrentRoot,null,!1,null,"",a,null);let h;n||tt.set(e,{fiber:m,store:p});let v,g=!1;return{configure(t={}){let{gl:n,size:r,scene:o,events:a,onCreated:m,shadows:y=!1,linear:E=!1,flat:P=!1,legacy:M=!1,orthographic:C=!1,frameloop:j="always",dpr:S=[1,2],performance:O,raycaster:k,camera:z,onPointerMissed:A}=t,T=p.getState(),R=T.gl;T.gl||T.set({gl:R=st(n,e)});let L=T.raycaster;L||T.set({raycaster:L=new i});const{params:I,...D}=k||{};if(Ee.equ(D,L,it)||at(L,{...D}),Ee.equ(I,L.params,it)||at(L,{params:{...L.params,...I}}),!T.camera||T.camera===v&&!Ee.equ(v,z,it)){v=z;const e=z instanceof b,t=e?z:C?new s(0,0,0,0,.1,1e3):new c(75,0,.1,1e3);e||(t.position.z=5,z&&(at(t,z),("aspect"in z||"left"in z||"right"in z||"bottom"in z||"top"in z)&&(t.manual=!0,t.updateProjectionMatrix())),T.camera||null!=z&&z.rotation||t.lookAt(0,0,0)),T.set({camera:t}),L.camera=t}if(!T.scene){let e;o instanceof l?e=o:(e=new l,o&&at(e,o)),T.set({scene:Pe(e)})}if(!T.xr){var F;const e=(e,t)=>{const n=p.getState();"never"!==n.frameloop&&rt(e,!0,n,t)},t=()=>{const t=p.getState();t.gl.xr.enabled=t.gl.xr.isPresenting,t.gl.xr.setAnimationLoop(t.gl.xr.isPresenting?e:null),t.gl.xr.isPresenting||nt(t)},n={connect(){const e=p.getState().gl;e.xr.addEventListener("sessionstart",t),e.xr.addEventListener("sessionend",t)},disconnect(){const e=p.getState().gl;e.xr.removeEventListener("sessionstart",t),e.xr.removeEventListener("sessionend",t)}};"function"==typeof(null==(F=R.xr)?void 0:F.addEventListener)&&n.connect(),T.set({xr:n})}if(R.shadowMap){const e=R.shadowMap.enabled,t=R.shadowMap.type;if(R.shadowMap.enabled=!!y,Ee.boo(y))R.shadowMap.type=u;else if(Ee.str(y)){var H;const e={basic:w,percentage:_,soft:u,variance:x};R.shadowMap.type=null!=(H=e[y])?H:u}else Ee.obj(y)&&Object.assign(R.shadowMap,y);e===R.shadowMap.enabled&&t===R.shadowMap.type||(R.shadowMap.needsUpdate=!0)}const W=fe();if(W&&("enabled"in W?W.enabled=!M:"legacyMode"in W&&(W.legacyMode=M)),!g){at(R,{outputEncoding:E?3e3:3001,toneMapping:P?f:d})}T.legacy!==M&&T.set((()=>({legacy:M}))),T.linear!==E&&T.set((()=>({linear:E}))),T.flat!==P&&T.set((()=>({flat:P}))),!n||Ee.fun(n)||De(n)||Ee.equ(n,R,it)||at(R,n),a&&!T.events.handlers&&T.set({events:a(p)});const $=function(e,t){const n="undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement;if(t){const{width:e,height:r,top:o,left:a,updateStyle:i=n}=t;return{width:e,height:r,top:o,left:a,updateStyle:i}}if("undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:t,height:r,top:o,left:a}=e.parentElement.getBoundingClientRect();return{width:t,height:r,top:o,left:a,updateStyle:n}}return"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas?{width:e.width,height:e.height,top:0,left:0,updateStyle:n}:{width:0,height:0,top:0,left:0}}(e,r);return Ee.equ($,T.size,it)||T.setSize($.width,$.height,$.updateStyle,$.top,$.left),S&&T.viewport.dpr!==we(S)&&T.setDpr(S),T.frameloop!==j&&T.setFrameloop(j),T.onPointerMissed||T.set({onPointerMissed:A}),O&&!Ee.equ(O,T.performance,it)&&T.set((e=>({performance:{...e.performance,...O}}))),h=m,g=!0,this},render(n){return g||this.configure(),ot.updateContainer(t.jsx(lt,{store:p,children:n,onCreated:h,rootElement:e}),m,null,(()=>{})),p},unmount(){ut(e)}}}function lt({store:e,children:n,onCreated:r,rootElement:o}){return pe((()=>{const t=e.getState();t.set((e=>({internal:{...e.internal,active:!0}}))),r&&r(t),e.getState().events.connected||null==t.events.connect||t.events.connect(o)}),[]),t.jsx(Fe.Provider,{value:e,children:n})}function ut(e,t){const n=tt.get(e),r=null==n?void 0:n.fiber;if(r){const t=null==n?void 0:n.store.getState();t&&(t.internal.active=!1),ot.updateContainer(null,r,null,(()=>{t&&setTimeout((()=>{try{var n,r,o,a;null==t.events.disconnect||t.events.disconnect(),null==(n=t.gl)||null==(r=n.renderLists)||null==r.dispose||r.dispose(),null==(o=t.gl)||null==o.forceContextLoss||o.forceContextLoss(),null!=(a=t.gl)&&a.xr&&t.xr.disconnect(),function(e){e.dispose&&"Scene"!==e.type&&e.dispose();for(const t in e)null==t.dispose||t.dispose(),delete e[t]}(t),tt.delete(e)}catch(i){}}),500)}))}}ot.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:e.version});const ft={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function dt(e){const{handlePointer:t}=Ie(e);return{priority:1,enabled:!0,compute(e,t,n){t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys(ft).reduce(((e,n)=>({...e,[n]:t(n)})),{}),update:()=>{var t;const{events:n,internal:r}=e.getState();null!=(t=r.lastEvent)&&t.current&&n.handlers&&n.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{var n;const{set:r,events:o}=e.getState();null==o.disconnect||o.disconnect(),r((e=>({events:{...e.events,connected:t}}))),Object.entries(null!=(n=o.handlers)?n:[]).forEach((([e,n])=>{const[r,o]=ft[e];t.addEventListener(r,n,{passive:o})}))},disconnect:()=>{const{set:t,events:n}=e.getState();var r;n.connected&&(Object.entries(null!=(r=n.handlers)?r:[]).forEach((([e,t])=>{if(n&&n.connected instanceof HTMLElement){const[r]=ft[e];n.connected.removeEventListener(r,t)}})),t((e=>({events:{...e.events,connected:void 0}}))))}}}function pt({debounce:t,scroll:n,polyfill:r,offsetSize:o}={debounce:0,scroll:!1,offsetSize:!1}){const a=r||"undefined"!=typeof window&&window.ResizeObserver,[i,s]=e.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0});if(!a)return i.width=1280,i.height=800,[()=>{},i,()=>{}];const c=e.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:i,orientationHandler:null}),l=t?"number"==typeof t?t:t.scroll:null,u=t?"number"==typeof t?t:t.resize:null,f=e.useRef(!1);e.useEffect((()=>(f.current=!0,()=>{f.current=!1})));const[d,p,m]=e.useMemo((()=>{const e=()=>{if(!c.current.element)return;const{left:e,top:t,width:n,height:r,bottom:a,right:i,x:l,y:u}=c.current.element.getBoundingClientRect(),d={left:e,top:t,width:n,height:r,bottom:a,right:i,x:l,y:u};c.current.element instanceof HTMLElement&&o&&(d.height=c.current.element.offsetHeight,d.width=c.current.element.offsetWidth),Object.freeze(d),f.current&&!vt(c.current.lastBounds,d)&&s(c.current.lastBounds=d)};return[e,u?F(e,u):e,l?F(e,l):e]}),[s,o,l,u]);function h(){c.current.scrollContainers&&(c.current.scrollContainers.forEach((e=>e.removeEventListener("scroll",m,!0))),c.current.scrollContainers=null),c.current.resizeObserver&&(c.current.resizeObserver.disconnect(),c.current.resizeObserver=null),c.current.orientationHandler&&screen.orientation.removeEventListener("orientationchange",c.current.orientationHandler)}function v(){c.current.element&&(c.current.resizeObserver=new a(m),c.current.resizeObserver.observe(c.current.element),n&&c.current.scrollContainers&&c.current.scrollContainers.forEach((e=>e.addEventListener("scroll",m,{capture:!0,passive:!0}))),c.current.orientationHandler=()=>{m()})}var g,y,b;return g=m,y=Boolean(n),e.useEffect((()=>{if(y){const e=g;return window.addEventListener("scroll",e,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",e,!0)}}}),[g,y]),b=p,e.useEffect((()=>{const e=b;return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[b]),e.useEffect((()=>{h(),v()}),[n,m,p]),e.useEffect((()=>h),[]),[e=>{e&&e!==c.current.element&&(h(),c.current.element=e,c.current.scrollContainers=mt(e),v())},i,d]}function mt(e){const t=[];if(!e||e===document.body)return t;const{overflow:n,overflowX:r,overflowY:o}=window.getComputedStyle(e);return[n,r,o].some((e=>"auto"===e||"scroll"===e))&&t.push(e),[...t,...mt(e.parentElement)]}const ht=["x","y","top","bottom","left","right","width","height"],vt=(e,t)=>ht.every((n=>e[n]===t[n])),gt=e.forwardRef((function({children:n,fallback:r,resize:o,style:a,gl:i,events:s=dt,eventSource:c,eventPrefix:l,shadows:u,linear:f,flat:d,legacy:p,orthographic:m,frameloop:h,dpr:v,performance:g,raycaster:y,camera:b,scene:w,onPointerMissed:_,onCreated:x,...E},M){e.useMemo((()=>{return e=P,void Object.assign(se,e);var e}),[]);const C=W(),[j,S]=pt({scroll:!0,debounce:{scroll:50,resize:0},...o}),O=e.useRef(null),k=e.useRef(null);e.useImperativeHandle(M,(()=>O.current));const z=me(_),[A,T]=e.useState(!1),[R,L]=e.useState(!1);if(A)throw A;if(R)throw R;const I=e.useRef(null);pe((()=>{const r=O.current;S.width>0&&S.height>0&&r&&(I.current||(I.current=ct(r)),I.current.configure({gl:i,events:s,shadows:u,linear:f,flat:d,legacy:p,orthographic:m,frameloop:h,dpr:v,performance:g,raycaster:y,camera:b,scene:w,size:S,onPointerMissed:(...e)=>null==z.current?void 0:z.current(...e),onCreated:e=>{var t;null==e.events.connect||e.events.connect(c?(t=c)&&t.hasOwnProperty("current")?c.current:c:k.current),l&&e.setEvents({compute:(e,t)=>{const n=e[l+"X"],r=e[l+"Y"];t.pointer.set(n/t.size.width*2-1,-r/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),null==x||x(e)}}),I.current.render(t.jsx(C,{children:t.jsx(ve,{set:L,children:t.jsx(e.Suspense,{fallback:t.jsx(he,{set:T}),children:n})})})))})),e.useEffect((()=>{const e=O.current;if(e)return()=>ut(e)}),[]);const D=c?"none":"auto";return t.jsx("div",{ref:k,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:D,...a},...E,children:t.jsx("div",{ref:j,style:{width:"100%",height:"100%"},children:t.jsx("canvas",{ref:O,style:{display:"block"},children:r})})})})),yt=e.forwardRef((function(e,n){return t.jsx(H,{children:t.jsx(gt,{...e,ref:n})})})),bt=new v,wt=new v,_t=new v,xt=new g;function Et(e,t,n){const r=bt.setFromMatrixPosition(e.matrixWorld);r.project(t);const o=n.width/2,a=n.height/2;return[r.x*o+o,-r.y*a+a]}const Pt=e=>Math.abs(e)<1e-10?0:e;function Mt(e,t,n=""){let r="matrix3d(";for(let o=0;16!==o;o++)r+=Pt(t[o]*e.elements[o])+(15!==o?",":")");return n+r}const Ct=(e=>t=>Mt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),jt=(()=>(e,t)=>{return Mt(e,[1/(n=t),1/n,1/n,1,-1/n,-1/n,-1/n,-1,1/n,1/n,1/n,1,1,1,1,1],"translate(-50%,-50%)");var n})();const St=e.forwardRef((({children:t,eps:n=.001,style:r,className:o,prepend:a,center:i,fullscreen:l,portal:u,distanceFactor:f,sprite:d=!1,transform:p=!1,occlude:m,onOcclude:h,castShadow:g,receiveShadow:y,material:b,geometry:w,zIndexRange:_=[16777271,0],calculatePosition:x=Et,as:E="div",wrapperClass:P,pointerEvents:C="auto",...j},S)=>{const{gl:O,camera:k,scene:z,size:A,raycaster:T,events:R,viewport:L}=Ze(),[I]=e.useState((()=>document.createElement(E))),D=e.useRef(),F=e.useRef(null),H=e.useRef(0),W=e.useRef([0,0]),$=e.useRef(null),U=e.useRef(null),N=(null==u?void 0:u.current)||R.connected||O.domElement.parentNode,G=e.useRef(null),Y=e.useRef(!1),V=e.useMemo((()=>m&&"blending"!==m||Array.isArray(m)&&m.length&&function(e){return e&&"object"==typeof e&&"current"in e}(m[0])),[m]);e.useLayoutEffect((()=>{const e=O.domElement;m&&"blending"===m?(e.style.zIndex=`${Math.floor(_[0]/2)}`,e.style.position="absolute",e.style.pointerEvents="none"):(e.style.zIndex=null,e.style.position=null,e.style.pointerEvents=null)}),[m]),e.useLayoutEffect((()=>{if(F.current){const e=D.current=B(I);if(z.updateMatrixWorld(),p)I.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const e=x(F.current,k,A);I.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${e[0]}px,${e[1]}px,0);transform-origin:0 0;`}return N&&(a?N.prepend(I):N.appendChild(I)),()=>{N&&N.removeChild(I),e.unmount()}}}),[N,p]),e.useLayoutEffect((()=>{P&&(I.className=P)}),[P]);const X=e.useMemo((()=>p?{position:"absolute",top:0,left:0,width:A.width,height:A.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:i?"translate3d(-50%,-50%,0)":"none",...l&&{top:-A.height/2,left:-A.width/2,width:A.width,height:A.height},...r}),[r,i,l,A,p]),Z=e.useMemo((()=>({position:"absolute",pointerEvents:C})),[C]);e.useLayoutEffect((()=>{var n,a;(Y.current=!1,p)?null==(n=D.current)||n.render(e.createElement("div",{ref:$,style:X},e.createElement("div",{ref:U,style:Z},e.createElement("div",{ref:S,className:o,style:r,children:t})))):null==(a=D.current)||a.render(e.createElement("div",{ref:S,style:X,className:o,children:t}))}));const J=e.useRef(!0);Je((e=>{if(F.current){k.updateMatrixWorld(),F.current.updateWorldMatrix(!0,!1);const e=p?W.current:x(F.current,k,A);if(p||Math.abs(H.current-k.zoom)>n||Math.abs(W.current[0]-e[0])>n||Math.abs(W.current[1]-e[1])>n){const t=function(e,t){const n=bt.setFromMatrixPosition(e.matrixWorld),r=wt.setFromMatrixPosition(t.matrixWorld),o=n.sub(r),a=t.getWorldDirection(_t);return o.angleTo(a)>Math.PI/2}(F.current,k);let n=!1;V&&(Array.isArray(m)?n=m.map((e=>e.current)):"blending"!==m&&(n=[z]));const r=J.current;if(n){const e=function(e,t,n,r){const o=bt.setFromMatrixPosition(e.matrixWorld),a=o.clone();a.project(t),xt.set(a.x,a.y),n.setFromCamera(xt,t);const i=n.intersectObjects(r,!0);if(i.length){const e=i[0].distance;return o.distanceTo(n.ray.origin)<e}return!0}(F.current,k,T,n);J.current=e&&!t}else J.current=!t;r!==J.current&&(h?h(!J.current):I.style.display=J.current?"block":"none");const o=Math.floor(_[0]/2),a=m?V?[_[0],o]:[o-1,0]:_;if(I.style.zIndex=`${function(e,t,n){if(t instanceof c||t instanceof s){const r=bt.setFromMatrixPosition(e.matrixWorld),o=wt.setFromMatrixPosition(t.matrixWorld),a=r.distanceTo(o),i=(n[1]-n[0])/(t.far-t.near),s=n[1]-i*t.far;return Math.round(i*a+s)}}(F.current,k,a)}`,p){const[e,t]=[A.width/2,A.height/2],n=k.projectionMatrix.elements[5]*t,{isOrthographicCamera:r,top:o,left:a,bottom:i,right:s}=k,c=Ct(k.matrixWorldInverse),l=r?`scale(${n})translate(${Pt(-(s+a)/2)}px,${Pt((o+i)/2)}px)`:`translateZ(${n}px)`;let u=F.current.matrixWorld;d&&(u=k.matrixWorldInverse.clone().transpose().copyPosition(u).scale(F.current.scale),u.elements[3]=u.elements[7]=u.elements[11]=0,u.elements[15]=1),I.style.width=A.width+"px",I.style.height=A.height+"px",I.style.perspective=r?"":`${n}px`,$.current&&U.current&&($.current.style.transform=`${l}${c}translate(${e}px,${t}px)`,U.current.style.transform=jt(u,1/((f||10)/400)))}else{const t=void 0===f?1:function(e,t){if(t instanceof s)return t.zoom;if(t instanceof c){const n=bt.setFromMatrixPosition(e.matrixWorld),r=wt.setFromMatrixPosition(t.matrixWorld),o=t.fov*Math.PI/180,a=n.distanceTo(r);return 1/(2*Math.tan(o/2)*a)}return 1}(F.current,k)*f;I.style.transform=`translate3d(${e[0]}px,${e[1]}px,0) scale(${t})`}W.current=e,H.current=k.zoom}}if(!V&&G.current&&!Y.current)if(p){if($.current){const e=$.current.children[0];if(null!=e&&e.clientWidth&&null!=e&&e.clientHeight){const{isOrthographicCamera:t}=k;if(t||w)j.scale&&(Array.isArray(j.scale)?j.scale instanceof v?G.current.scale.copy(j.scale.clone().divideScalar(1)):G.current.scale.set(1/j.scale[0],1/j.scale[1],1/j.scale[2]):G.current.scale.setScalar(1/j.scale));else{const t=(f||10)/400,n=e.clientWidth*t,r=e.clientHeight*t;G.current.scale.set(n,r,1)}Y.current=!0}}}else{const t=I.children[0];if(null!=t&&t.clientWidth&&null!=t&&t.clientHeight){const e=1/L.factor,n=t.clientWidth*e,r=t.clientHeight*e;G.current.scale.set(n,r,1),Y.current=!0}G.current.lookAt(e.camera.position)}}));const K=e.useMemo((()=>({vertexShader:p?void 0:'\n          /*\n            This shader is from the THREE\'s SpriteMaterial.\n            We need to turn the backing plane into a Sprite\n            (make it always face the camera) if "transfrom"\n            is false.\n          */\n          #include <common>\n\n          void main() {\n            vec2 center = vec2(0., 1.);\n            float rotation = 0.0;\n\n            // This is somewhat arbitrary, but it seems to work well\n            // Need to figure out how to derive this dynamically if it even matters\n            float size = 0.03;\n\n            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n            vec2 scale;\n            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n            bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n            if ( isPerspective ) scale *= - mvPosition.z;\n\n            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;\n            vec2 rotatedPosition;\n            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n            mvPosition.xy += rotatedPosition;\n\n            gl_Position = projectionMatrix * mvPosition;\n          }\n      ',fragmentShader:"\n        void main() {\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n        }\n      "})),[p]);return e.createElement("group",q({},j,{ref:F}),m&&!V&&e.createElement("mesh",{castShadow:g,receiveShadow:y,ref:G},w||e.createElement("planeGeometry",null),b||e.createElement("shaderMaterial",{side:M,vertexShader:K.vertexShader,fragmentShader:K.fragmentShader})))}));let Ot=0;const kt=N((e=>(C.onStart=(t,n,r)=>{e({active:!0,item:t,loaded:n,total:r,progress:(n-Ot)/(r-Ot)*100})},C.onLoad=()=>{e({active:!1})},C.onError=t=>e((e=>({errors:[...e.errors,t]}))),C.onProgress=(t,n,r)=>{n===r&&(Ot=r),e({active:!0,item:t,loaded:n,total:r,progress:(n-Ot)/(r-Ot)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}))),zt=e=>e===Object(e)&&!Array.isArray(e)&&"function"!=typeof e;function At(t,n){const o=Ze((e=>e.gl)),a=et(j,zt(t)?Object.values(t):t);e.useLayoutEffect((()=>{null==n||n(a)}),[n]),e.useEffect((()=>{if("initTexture"in o){let e=[];Array.isArray(a)?e=a:a instanceof r?e=[a]:zt(a)&&(e=Object.values(a)),e.forEach((e=>{e instanceof r&&o.initTexture(e)}))}}),[o,a]);return e.useMemo((()=>{if(zt(t)){const e={};let n=0;for(const r in t)e[r]=a[n++];return e}return a}),[t,a])}At.preload=e=>et.preload(j,e),At.clear=e=>et.clear(j,e);const Tt=(()=>parseInt(S.replace(/\D+/g,"")))();function Rt(e=[0,0,0]){return function(e){return Array.isArray(e)}(e)?e:e instanceof v||e instanceof k?[e.x,e.y,e.z]:[e,e,e]}const Lt=e.forwardRef((function({debug:t,depthTest:n=!1,polygonOffsetFactor:r=-10,map:o,mesh:a,children:i,position:s,rotation:c,scale:l,...u},f){const d=e.useRef(null);e.useImperativeHandle(f,(()=>d.current));const p=e.useRef(null);return e.useLayoutEffect((()=>{const e=(null==a?void 0:a.current)||d.current.parent,t=d.current;if(!(e instanceof O))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const n={position:new v,rotation:new k,scale:new v(1,1,1)};if(e){at(n,{position:s,scale:l});const r=e.matrixWorld.clone();if(e.matrixWorld.identity(),c&&"number"!=typeof c)at(n,{rotation:c});else{const t=new z;t.position.copy(n.position),t.lookAt(e.position),"number"==typeof c&&t.rotateZ(c),at(n,{rotation:t.rotation})}return t.geometry=new G(e,n.position,n.rotation,n.scale),p.current&&(at(p.current,n),p.current.traverse((e=>e.raycast=()=>null))),e.matrixWorld=r,()=>{t.geometry.dispose()}}}),[a,...Rt(s),...Rt(l),...Rt(c)]),e.createElement("mesh",q({ref:d,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":r,"material-depthTest":n,"material-map":o},u),i,t&&e.createElement("mesh",{ref:p},e.createElement("boxGeometry",null),e.createElement("meshNormalMaterial",{wireframe:!0}),e.createElement("axesHelper",null)))}));let It=null,Dt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Ft(e=!0,t=!0,n){return r=>{n&&n(r),e&&(It||(It=new V),It.setDecoderPath("string"==typeof e?e:Dt),r.setDRACOLoader(It)),t&&r.setMeshoptDecoder("function"==typeof X?X():X)}}const Ht=(e,t,n,r)=>et(Y,e,Ft(t,n,r));Ht.preload=(e,t,n,r)=>et.preload(Y,e,Ft(t,n,r)),Ht.clear=e=>et.clear(Y,e),Ht.setDecoderPath=e=>{Dt=e};const Wt=e.forwardRef((({makeDefault:t,camera:n,regress:r,domElement:o,enableDamping:a=!0,keyEvents:i=!1,onChange:s,onStart:c,onEnd:l,...u},f)=>{const d=Ze((e=>e.invalidate)),p=Ze((e=>e.camera)),m=Ze((e=>e.gl)),h=Ze((e=>e.events)),v=Ze((e=>e.setEvents)),g=Ze((e=>e.set)),y=Ze((e=>e.get)),b=Ze((e=>e.performance)),w=n||p,_=o||h.connected||m.domElement,x=e.useMemo((()=>new Z(w)),[w]);return Je((()=>{x.enabled&&x.update()}),-1),e.useEffect((()=>(i&&x.connect(!0===i?_:i),x.connect(_),()=>{x.dispose()})),[i,_,r,x,d]),e.useEffect((()=>{const e=e=>{d(),r&&b.regress(),s&&s(e)},t=e=>{c&&c(e)},n=e=>{l&&l(e)};return x.addEventListener("change",e),x.addEventListener("start",t),x.addEventListener("end",n),()=>{x.removeEventListener("start",t),x.removeEventListener("end",n),x.removeEventListener("change",e)}}),[s,c,l,x,d,v]),e.useEffect((()=>{if(t){const e=y().controls;return g({controls:x}),()=>g({controls:e})}}),[t,x]),e.createElement("primitive",q({ref:f,object:x,enableDamping:a},u))})),$t=Tt>=154?"opaque_fragment":"output_fragment";class Ut extends A{constructor(e){super(e),this.onBeforeCompile=(e,t)=>{const{isWebGL2:n}=t.capabilities;e.fragmentShader=e.fragmentShader.replace(`#include <${$t}>`,`\n        ${n?`#include <${$t}>`:`#extension GL_OES_standard_derivatives : enable\n#include <${$t}>`}\n      vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n      float r = dot(cxy, cxy);\n      float delta = fwidth(r);     \n      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\n      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );\n      #include <tonemapping_fragment>\n      #include <${Tt>=154?"colorspace_fragment":"encodings_fragment"}>\n      `)}}}const qt=e.forwardRef(((t,n)=>{const[r]=e.useState((()=>new Ut(null)));return e.createElement("primitive",q({},t,{object:r,ref:n,attach:"material"}))})),Bt=e.forwardRef((({children:t,enabled:n=!0,speed:r=1,rotationIntensity:o=1,floatIntensity:a=1,floatingRange:i=[-.1,.1],autoInvalidate:s=!1,...c},l)=>{const u=e.useRef(null);e.useImperativeHandle(l,(()=>u.current),[]);const f=e.useRef(1e4*Math.random());return Je((e=>{var t,c;if(!n||0===r)return;s&&e.invalidate();const l=f.current+e.clock.getElapsedTime();u.current.rotation.x=Math.cos(l/4*r)/8*o,u.current.rotation.y=Math.sin(l/4*r)/8*o,u.current.rotation.z=Math.sin(l/4*r)/20*o;let d=Math.sin(l/4*r)/10;d=T.mapLinear(d,-.1,.1,null!==(t=null==i?void 0:i[0])&&void 0!==t?t:-.1,null!==(c=null==i?void 0:i[1])&&void 0!==c?c:.1),u.current.position.y=d*a,u.current.updateMatrix()})),e.createElement("group",c,e.createElement("group",{ref:u,matrixAutoUpdate:!1},t))}));let Nt,Gt;const Yt=e.createContext(null),Vt=new L,Xt=new v,Zt=e.forwardRef((({children:t,range:n,limit:r=1e3,...o},a)=>{const i=e.useRef(null);e.useImperativeHandle(a,(()=>i.current),[]);const[s,c]=e.useState([]),[[l,u,f]]=e.useState((()=>[new Float32Array(3*r),Float32Array.from({length:3*r},(()=>1)),Float32Array.from({length:r},(()=>1))]));e.useEffect((()=>{i.current.geometry.attributes.position.needsUpdate=!0})),Je((()=>{for(i.current.updateMatrix(),i.current.updateMatrixWorld(),Vt.copy(i.current.matrixWorld).invert(),i.current.geometry.drawRange.count=Math.min(r,void 0!==n?n:r,s.length),Nt=0;Nt<s.length;Nt++)Gt=s[Nt].current,Gt.getWorldPosition(Xt).applyMatrix4(Vt),Xt.toArray(l,3*Nt),i.current.geometry.attributes.position.needsUpdate=!0,Gt.matrixWorldNeedsUpdate=!0,Gt.color.toArray(u,3*Nt),i.current.geometry.attributes.color.needsUpdate=!0,f.set([Gt.size],Nt),i.current.geometry.attributes.size.needsUpdate=!0}));const d=e.useMemo((()=>({getParent:()=>i,subscribe:e=>(c((t=>[...t,e])),()=>c((t=>t.filter((t=>t.current!==e.current)))))})),[]);return e.createElement("points",q({userData:{instances:s},matrixAutoUpdate:!1,ref:i,raycast:()=>null},o),e.createElement("bufferGeometry",null,e.createElement("bufferAttribute",{attach:"attributes-position",count:l.length/3,array:l,itemSize:3,usage:R}),e.createElement("bufferAttribute",{attach:"attributes-color",count:u.length/3,array:u,itemSize:3,usage:R}),e.createElement("bufferAttribute",{attach:"attributes-size",count:f.length,array:f,itemSize:1,usage:R})),e.createElement(Yt.Provider,{value:d},t))})),Jt=e.forwardRef((({children:t,positions:n,colors:r,sizes:o,stride:a=3,...i},s)=>{const c=e.useRef(null);return e.useImperativeHandle(s,(()=>c.current),[]),Je((()=>{const e=c.current.geometry.attributes;e.position.needsUpdate=!0,r&&(e.color.needsUpdate=!0),o&&(e.size.needsUpdate=!0)})),e.createElement("points",q({ref:c},i),e.createElement("bufferGeometry",null,e.createElement("bufferAttribute",{attach:"attributes-position",count:n.length/a,array:n,itemSize:a,usage:R}),r&&e.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/a,array:r,itemSize:3,usage:R}),o&&e.createElement("bufferAttribute",{attach:"attributes-size",count:o.length/a,array:o,itemSize:1,usage:R})),t)})),Kt=e.forwardRef(((t,n)=>t.positions instanceof Float32Array?e.createElement(Jt,q({},t,{ref:n})):e.createElement(Zt,q({},t,{ref:n}))));function Qt({all:t,scene:n,camera:r}){const o=Ze((({gl:e})=>e)),a=Ze((({camera:e})=>e)),i=Ze((({scene:e})=>e));return e.useLayoutEffect((()=>{const e=[];t&&(n||i).traverse((t=>{!1===t.visible&&(e.push(t),t.visible=!0)})),o.compile(n||i,r||a);const s=new I(128);new D(.01,1e5,s).update(o,n||i),s.dispose(),e.forEach((e=>e.visible=!1))}),[]),null}export{yt as C,Lt as D,Bt as F,St as H,Wt as O,Qt as P,re as _,te as a,At as b,kt as c,Je as d,Kt as e,qt as f,ee as g,Ht as u};
